# V3 ì§„ì… ì „ëµ ì„¤ê³„ì„œ

**ì‘ì„±ì¼**: 2025-10-22
**ë²„ì „**: 3.0.0
**ìƒíƒœ**: ì„¤ê³„ ë‹¨ê³„ (êµ¬í˜„ ëŒ€ê¸°)

---

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”](#ê°œìš”)
2. [ê¸°ì¡´ ì‹œìŠ¤í…œì˜ ë¬¸ì œì ](#ê¸°ì¡´-ì‹œìŠ¤í…œì˜-ë¬¸ì œì )
3. [ìƒˆë¡œìš´ ì§„ì… ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#ìƒˆë¡œìš´-ì§„ì…-ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
4. [ì‹œì¥ ìƒíƒœ ë¶„ë¥˜ ì‹œìŠ¤í…œ](#ì‹œì¥-ìƒíƒœ-ë¶„ë¥˜-ì‹œìŠ¤í…œ)
5. [ì§„ì… ì „ëµ ìƒì„¸](#ì§„ì…-ì „ëµ-ìƒì„¸)
6. [ë¦¬ìŠ¤í¬ ê´€ë¦¬](#ë¦¬ìŠ¤í¬-ê´€ë¦¬)
7. [êµ¬í˜„ ê³„íš](#êµ¬í˜„-ê³„íš)

---

## ê°œìš”

### ëª©ì 
ë³µí•© ì§€í‘œ ë¶„ì„, ë°´ë“œì›Œí‚¹ ê°ì§€, ë¸Œë ˆì´í¬ì•„ì›ƒ êµ¬ë¶„ì„ í†µí•©í•œ **ì •í™•í•˜ê³  ì‹ ë¢°ë„ ë†’ì€ ì§„ì… ì‹œìŠ¤í…œ** êµ¬ì¶•

### í•µì‹¬ ê°œì„ ì‚¬í•­
1. **ë³µí•© ì§€í‘œ ì‹œìŠ¤í…œ**: RSI(25%) + Volume(20%) + Price Action(20%) + MA Trend(15%) + BB(10%) + MACD(10%)
2. **ë°´ë“œì›Œí‚¹ ì‚¬ì „ ê°ì§€**: ì—­ì¶”ì„¸ ì§„ì… ì°¨ë‹¨ + ì¶”ì„¸ ì¶”ì¢… í™œì„±í™”
3. **ë¸Œë ˆì´í¬ì•„ì›ƒ êµ¬ë¶„**: Headfake / Breakout / Band Walking ëª…í™•íˆ êµ¬ë¶„
4. **ì‹ ë¢°ë„ ê¸°ë°˜ í¬ì§€ì…˜ ì‚¬ì´ì§•**: HIGH/MEDIUM/LOWì— ë”°ë¥¸ ì°¨ë“± í¬ì§€ì…˜

### ê¸°ëŒ€ íš¨ê³¼
- ìŠ¹ë¥ : 62% â†’ 70%+
- Profit Factor: 0.25 â†’ 0.8+
- ê±°ì§“ ì‹ í˜¸ í•„í„°ë§: 10-15% ì†ì‹¤ ê°ì†Œ
- ì¶”ì„¸ ì¶”ì¢… ìˆ˜ìµ: 5-10% ì¦ê°€

---

## ê¸°ì¡´ ì‹œìŠ¤í…œì˜ ë¬¸ì œì 

### 1. RSI ë‹¨ë… ì˜ì¡´ (v1~v2)

**ë¬¸ì œ ì‚¬ë¡€: 2025-10-21 04:30**
```yaml
ìƒí™©:
  RSI: 17.78 (ê·¹ë‹¨ì  ê³¼ë§¤ë„)
  ê¸°ì¡´ íŒë‹¨: "LONG ì§„ì…!"
  ì‹¤ì œ ê²°ê³¼: í•˜ë½ ì§€ì† â†’ ì†ì‹¤

ì›ì¸:
  - RSIë§Œ ë³´ê³  íŒë‹¨
  - MACD íˆìŠ¤í† ê·¸ë¨ ì•…í™” ì¤‘ (ë¬´ì‹œë¨)
  - í•˜ë½ ì¶”ì„¸ ê°•ë„ ë¯¸ë°˜ì˜
```

### 2. ë°´ë“œì›Œí‚¹ ë¯¸ê°ì§€

**ë¬¸ì œ ì‚¬ë¡€: 2025-10-21 23:10~00:05 (ìƒìŠ¹ ë°´ë“œì›Œí‚¹)**
```yaml
ìƒí™©:
  ê°€ê²©: $3,926 â†’ $4,030 (+2.65%)
  RSI: 65+ ìœ ì§€ (ê³¼ë§¤ìˆ˜)
  ê¸°ì¡´ íŒë‹¨: "SHORT ì§„ì…!" (ì—­ì¶”ì„¸)
  ì‹¤ì œ ê²°ê³¼: -2.65% ì†ì‹¤

ì›ì¸:
  - ë°´ë“œì›Œí‚¹ ê°ì§€ ë¡œì§ ì—†ìŒ
  - ê°•í•œ ìƒìŠ¹ ì¶”ì„¸ì—ì„œ ì—­ì¶”ì„¸ ì§„ì…
```

**ë¬¸ì œ ì‚¬ë¡€: 2025-10-21 00:55~01:45 (í•˜ë½ ë°´ë“œì›Œí‚¹)**
```yaml
ìƒí™©:
  ê°€ê²©: $4,002 â†’ $3,933 (-1.72%)
  RSI: 34 â†’ 22 (ê³¼ë§¤ë„)
  ê¸°ì¡´ íŒë‹¨: "LONG ì§„ì…!" (ì—­ì¶”ì„¸)
  ì‹¤ì œ ê²°ê³¼: -1.72% ì†ì‹¤

ì›ì¸:
  - í•˜ë½ ë°´ë“œì›Œí‚¹ ë¯¸ê°ì§€
  - íŒ¨ë‹‰ ì…€ë§ êµ¬ê°„ì—ì„œ ë§¤ìˆ˜
```

### 3. ë¸Œë ˆì´í¬ì•„ì›ƒ vs í—¤ë“œí˜ì´í¬ êµ¬ë¶„ ë¶ˆê°€

```yaml
ë¬¸ì œ:
  - 1ê°œ ìº”ë“¤ ë°´ë“œ ëŒíŒŒ ì‹œ ì¦‰ì‹œ ì—­ì¶”ì„¸ ì§„ì…
  - ì§„ì§œ ë¸Œë ˆì´í¬ì•„ì›ƒì¸ì§€ í—¤ë“œí˜ì´í¬ì¸ì§€ êµ¬ë¶„ ì•ˆ í•¨
  - ë¸Œë ˆì´í¬ì•„ì›ƒì´ ë°´ë“œì›Œí‚¹ìœ¼ë¡œ ì „í™˜ë˜ëŠ” ê²½ìš° ëŒ€ì‘ ë¶ˆê°€
```

---

## ìƒˆë¡œìš´ ì§„ì… ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ğŸ—ï¸ 4ë‹¨ê³„ í•„í„°ë§ ì‹œìŠ¤í…œ

```
ì…ë ¥: ìº”ë“¤ ë°ì´í„° (50+ê°œ)
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stage 1: ë³µí•© ì§€í‘œ ë¶„ì„                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - Composite Analysis                    â”‚
â”‚ - 7ë‹¨ê³„ ì‹œì¥ ë¶„ë¥˜                        â”‚
â”‚ - ì‹ ë¢°ë„ í‰ê°€ (HIGH/MEDIUM/LOW)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stage 2: ë°´ë“œì›Œí‚¹ ê°ì§€                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - BB Width í™•ì¥ ì²´í¬                    â”‚
â”‚ - ì—°ì† ë°´ë“œ ë°– ìº”ë“¤ ì¹´ìš´íŠ¸               â”‚
â”‚ - MACD íˆìŠ¤í† ê·¸ë¨ íŠ¸ë Œë“œ                â”‚
â”‚ - Volume ì§€ì†ì„± í™•ì¸                    â”‚
â”‚ â†’ Score 60+ : ì—­ì¶”ì„¸ ì°¨ë‹¨               â”‚
â”‚ â†’ Score 70+ : ì¶”ì„¸ ì¶”ì¢… í™œì„±í™”          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stage 3: ë¸Œë ˆì´í¬ì•„ì›ƒ ë¶„ë¥˜               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - Headfake (1ìº”ë“¤, ë‚®ì€ Volume)         â”‚
â”‚ - Breakout (1-2ìº”ë“¤, ë†’ì€ Volume)       â”‚
â”‚ - Band Walking (3+ìº”ë“¤, ì§€ì†)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stage 4: ìµœì¢… ì§„ì… ê²°ì •                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - ì—­ì¶”ì„¸ ì „ëµ (í‰ê· íšŒê·€)                â”‚
â”‚ - ì¶”ì„¸ ì¶”ì¢… ì „ëµ (ë°´ë“œì›Œí‚¹)             â”‚
â”‚ - ê´€ë§ (ë¶ˆí™•ì‹¤í•œ ì‹ í˜¸)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
ì¶œë ¥: ì§„ì… ì‹ í˜¸ (LONG/SHORT/WAIT) + ì‹ ë¢°ë„ + í¬ì§€ì…˜ ì‚¬ì´ì¦ˆ
```

---

## ì‹œì¥ ìƒíƒœ ë¶„ë¥˜ ì‹œìŠ¤í…œ

### ğŸ“Š ë³µí•© ì ìˆ˜ ê¸°ë°˜ 7ë‹¨ê³„ ë¶„ë¥˜

```dart
enum MarketCondition {
  extremeBullish,   // Score > 0.6   : ê·¹ê°•ì„¸
  strongBullish,    // Score > 0.4   : ê°•ì„¸
  weakBullish,      // Score > 0.15  : ì•½ê°•ì„¸
  ranging,          // Score -0.15~0.15 : íš¡ë³´
  weakBearish,      // Score < -0.15 : ì•½ì•½ì„¸
  strongBearish,    // Score < -0.4  : ê°•ì•½ì„¸
  extremeBearish,   // Score < -0.6  : ê·¹ì•½ì„¸
}
```

### ğŸ“ˆ ë³µí•© ì ìˆ˜ ê³„ì‚°

```dart
compositeScore =
  (rsiScore * 0.25) +         // RSI ê¸°ì—¬ë„ 25%
  (volumeScore * 0.20) +      // Volume ê¸°ì—¬ë„ 20%
  (priceActionScore * 0.20) + // Price Action ê¸°ì—¬ë„ 20%
  (maTrendScore * 0.15) +     // MA Trend ê¸°ì—¬ë„ 15%
  (bbScore * 0.10) +          // BB ê¸°ì—¬ë„ 10%
  (macdScore * 0.10);         // MACD ê¸°ì—¬ë„ 10%

// ê²°ê³¼: -1.0 (ê·¹ì•½ì„¸) ~ +1.0 (ê·¹ê°•ì„¸)
```

### ğŸ¯ ì‹ ë¢°ë„ í‰ê°€

```dart
// 6ê°œ ì§€í‘œê°€ ê°™ì€ ë°©í–¥ì„ ê°€ë¦¬í‚¤ëŠ”ì§€ í™•ì¸
agreeCount = 0;
if (compositeScore > 0) {
  if (rsiScore > 0) agreeCount++;
  if (volumeScore > 0) agreeCount++;
  if (priceActionScore > 0) agreeCount++;
  if (maTrendScore > 0) agreeCount++;
  if (bbScore > 0) agreeCount++;
  if (macdScore > 0) agreeCount++;
}

ì‹ ë¢°ë„:
- HIGH:   agreeCount >= 5 (83%+ í•©ì˜)
- MEDIUM: agreeCount = 3-4 (50-83% í•©ì˜)
- LOW:    agreeCount <= 2 (<50% í•©ì˜)
```

---

## ë°´ë“œì›Œí‚¹ ê°ì§€ ì‹œìŠ¤í…œ

### ğŸš¨ ë°´ë“œì›Œí‚¹ ì ìˆ˜ ê³„ì‚° (100ì  ë§Œì )

```dart
class BandWalkingDetector {

  static BandWalkingSignal detect({
    required List<Candle> candles,
    required BollingerBands bb,
    required MACD macd,
    required List<MACD> macdHistory,
    required VolumeAnalysis volume,
    required double rsi,
    required List<double> rsiHistory,
  }) {
    int score = 0;
    List<String> reasons = [];

    // 1. BB Width í™•ì¥ (25ì )
    final bbWidth = (bb.upper - bb.lower) / bb.middle;
    final prevBBWidth = calculatePreviousBBWidth(candles);
    final bbWidthChangePercent = ((bbWidth - prevBBWidth) / prevBBWidth) * 100;

    if (bbWidthChangePercent > 5.0) {
      score += 25;
      reasons.add('BB Width ê¸‰ì¦ ${bbWidthChangePercent.toStringAsFixed(1)}%');
    } else if (bbWidthChangePercent > 2.0) {
      score += 15;
      reasons.add('BB Width í™•ì¥ ${bbWidthChangePercent.toStringAsFixed(1)}%');
    }

    // 2. ì—°ì† ë°´ë“œ ë°– ìº”ë“¤ (30ì )
    int consecutiveOutside = 0;
    for (var candle in candles.take(5)) {
      if (candle.close > bb.upper || candle.close < bb.lower) {
        consecutiveOutside++;
      } else {
        break;
      }
    }

    if (consecutiveOutside >= 3) {
      score += 30;
      reasons.add('$consecutiveOutsideê°œ ì—°ì† ë°´ë“œ ë°– ìº”ë“¤');
    } else if (consecutiveOutside >= 2) {
      score += 20;
      reasons.add('$consecutiveOutsideê°œ ì—°ì† ë°´ë“œ ë°– ìº”ë“¤');
    }

    // 3. MACD íˆìŠ¤í† ê·¸ë¨ ì§€ì† í™•ì¥ (20ì )
    if (macdHistory.length >= 3) {
      final currentHist = macd.histogram;
      final prevHist = macdHistory[macdHistory.length - 2].histogram;
      final histChange = currentHist - prevHist;

      // ê°™ì€ ë°©í–¥ìœ¼ë¡œ í™•ì¥ ì¤‘ì¸ì§€
      if (currentHist.abs() > 3.0 && histChange.abs() > 0.5) {
        if ((currentHist > 0 && histChange > 0) ||
            (currentHist < 0 && histChange < 0)) {
          score += 20;
          reasons.add('MACD íˆìŠ¤í† ê·¸ë¨ ì§€ì† í™•ì¥ (${currentHist.toStringAsFixed(2)})');
        }
      } else if (currentHist.abs() > 5.0) {
        score += 10;
        reasons.add('MACD íˆìŠ¤í† ê·¸ë¨ ê°•í•¨ (${currentHist.toStringAsFixed(2)})');
      }
    }

    // 4. Volume í™•ì¸ (15ì )
    if (volume.relativeVolumeRatio > 2.0) {
      score += 15;
      reasons.add('ë†’ì€ ê±°ë˜ëŸ‰ ${volume.relativeVolumeRatio.toStringAsFixed(1)}x');
    } else if (volume.relativeVolumeRatio > 1.5) {
      score += 10;
      reasons.add('ê±°ë˜ëŸ‰ ì¦ê°€ ${volume.relativeVolumeRatio.toStringAsFixed(1)}x');
    }

    // 5. RSI ì§€ì† (10ì )
    if (rsi > 70 || rsi < 30) {
      bool sustained = true;
      for (var prevRsi in rsiHistory.take(3)) {
        if (rsi > 70 && prevRsi < 65) sustained = false;
        if (rsi < 30 && prevRsi > 35) sustained = false;
      }

      if (sustained) {
        score += 10;
        reasons.add('RSI ${rsi > 70 ? "ê³¼ë§¤ìˆ˜" : "ê³¼ë§¤ë„"} ì§€ì† (${rsi.toStringAsFixed(1)})');
      }
    }

    // Risk Level ê²°ì •
    BandWalkingRisk risk;
    if (score >= 70) {
      risk = BandWalkingRisk.HIGH;
    } else if (score >= 50) {
      risk = BandWalkingRisk.MEDIUM;
    } else if (score >= 30) {
      risk = BandWalkingRisk.LOW;
    } else {
      risk = BandWalkingRisk.NONE;
    }

    return BandWalkingSignal(
      risk: risk,
      score: score,
      reasons: reasons,
      direction: candles.first.close > bb.upper ? 'UP' : 'DOWN',
      consecutiveOutside: consecutiveOutside,
    );
  }
}

enum BandWalkingRisk { NONE, LOW, MEDIUM, HIGH }

class BandWalkingSignal {
  final BandWalkingRisk risk;
  final int score;
  final List<String> reasons;
  final String direction;  // 'UP' or 'DOWN'
  final int consecutiveOutside;

  // ì—­ì¶”ì„¸ ì§„ì… ì°¨ë‹¨ ì—¬ë¶€
  bool get shouldBlockCounterTrend =>
    risk == BandWalkingRisk.HIGH ||
    risk == BandWalkingRisk.MEDIUM;

  // ì¶”ì„¸ ì¶”ì¢… ì§„ì… í™œì„±í™” ì—¬ë¶€
  bool get shouldEnterTrendFollow =>
    risk == BandWalkingRisk.HIGH;
}
```

---

## ë¸Œë ˆì´í¬ì•„ì›ƒ ë¶„ë¥˜ ì‹œìŠ¤í…œ

### ğŸ” 3ê°€ì§€ íŒ¨í„´ êµ¬ë¶„

```dart
enum BreakoutType {
  HEADFAKE,              // í—¤ë“œí˜ì´í¬ (ê±°ì§“ ëŒíŒŒ)
  BREAKOUT_INITIAL,      // ë¸Œë ˆì´í¬ì•„ì›ƒ ì´ˆê¸° (ê´€ë§ í•„ìš”)
  BREAKOUT_REVERSAL,     // ë¸Œë ˆì´í¬ì•„ì›ƒ ì‹¤íŒ¨ (ë³µê·€)
  BREAKOUT_TO_BANDWALKING, // ë°´ë“œì›Œí‚¹ ì „í™˜ ì¤‘
  BANDWALKING_CONFIRMED, // ë°´ë“œì›Œí‚¹ í™•ì •
}

class BreakoutClassifier {

  static BreakoutType classify({
    required BandWalkingSignal bandWalking,
    required VolumeAnalysis volume,
    required double rsi,
    required MACD macd,
  }) {

    final consecutiveOutside = bandWalking.consecutiveOutside;
    final volumeRatio = volume.relativeVolumeRatio;
    final rsiExtreme = rsi > 70 || rsi < 30;
    final macdStrong = macd.histogram.abs() > 5.0;

    // 1ê°œ ìº”ë“¤ë§Œ ë°´ë“œ ë°–
    if (consecutiveOutside == 1) {
      if (volumeRatio > 15.0) {
        return BreakoutType.BREAKOUT_INITIAL;  // ë¸Œë ˆì´í¬ì•„ì›ƒ ì´ˆê¸° (ê´€ë§)
      } else if (volumeRatio < 8.0) {
        return BreakoutType.HEADFAKE;  // í—¤ë“œí˜ì´í¬ (ì—­ì¶”ì„¸ ì§„ì… ê°€ëŠ¥)
      } else {
        return BreakoutType.BREAKOUT_INITIAL;  // ë¶ˆí™•ì‹¤ (ê´€ë§)
      }
    }

    // 2ê°œ ìº”ë“¤ ë°´ë“œ ë°–
    if (consecutiveOutside == 2) {
      if (rsiExtreme && volumeRatio > 5.0) {
        return BreakoutType.BREAKOUT_TO_BANDWALKING;  // ë°´ë“œì›Œí‚¹ ì „í™˜ ì¤‘
      } else {
        return BreakoutType.BREAKOUT_REVERSAL;  // ë¸Œë ˆì´í¬ì•„ì›ƒ ì‹¤íŒ¨
      }
    }

    // 3ê°œ+ ìº”ë“¤ ë°´ë“œ ë°–
    if (consecutiveOutside >= 3) {
      if (rsiExtreme && macdStrong && volumeRatio > 3.0) {
        return BreakoutType.BANDWALKING_CONFIRMED;  // ë°´ë“œì›Œí‚¹ í™•ì •
      } else {
        return BreakoutType.BREAKOUT_REVERSAL;  // ì•½í•œ ì¶”ì„¸ (ë³µê·€ ê°€ëŠ¥)
      }
    }

    return BreakoutType.HEADFAKE;
  }
}
```

### ğŸ“Š íŒ¨í„´ë³„ íŠ¹ì§•

| íŒ¨í„´ | ì—°ì† ìº”ë“¤ | Volume | RSI | í–‰ë™ |
|------|----------|--------|-----|------|
| **HEADFAKE** | 1ê°œ | <8x | ì¤‘ë¦½ | ì—­ì¶”ì„¸ ì§„ì… OK |
| **BREAKOUT_INITIAL** | 1-2ê°œ | >15x | ê·¹ë‹¨ ì‹œì‘ | **ê´€ë§** (3ìº”ë“¤ ëŒ€ê¸°) |
| **BREAKOUT_REVERSAL** | 2ê°œ | ê°ì†Œ | ë³µê·€ | ì—­ì¶”ì„¸ ì§„ì… ê³ ë ¤ |
| **BREAKOUT_TO_BANDWALKING** | 2-3ê°œ | >5x | ê·¹ë‹¨ ìœ ì§€ | ì—­ì¶”ì„¸ ì°¨ë‹¨ |
| **BANDWALKING_CONFIRMED** | 3ê°œ+ | >3x | ê·¹ë‹¨ ì§€ì† | ì¶”ì„¸ ì¶”ì¢… ì§„ì… |

---

## ì§„ì… ì „ëµ ìƒì„¸

### ğŸ¯ ì „ëµ 1: ì—­ì¶”ì„¸ (Counter-Trend) - í‰ê· íšŒê·€

**ì ìš© ì¡°ê±´**:
```dart
// ëª¨ë“  ì¡°ê±´ì„ ë™ì‹œì— ë§Œì¡±í•´ì•¼ ì§„ì…
if (
  // 1. ì‹œì¥ ì¡°ê±´: íš¡ë³´ì¥
  (marketCondition == ranging ||
   marketCondition == weakBullish ||
   marketCondition == weakBearish) &&

  // 2. ë°´ë“œì›Œí‚¹ ì—†ìŒ
  (bandWalkingSignal.risk == BandWalkingRisk.NONE ||
   bandWalkingSignal.risk == BandWalkingRisk.LOW) &&

  // 3. í—¤ë“œí˜ì´í¬ í™•ì¸
  (breakoutType == BreakoutType.HEADFAKE ||
   breakoutType == BreakoutType.BREAKOUT_REVERSAL) &&

  // 4. ì‹ ë¢°ë„ ì²´í¬
  (confidence == SignalConfidence.HIGH ||
   confidence == SignalConfidence.MEDIUM)
) {
  // ì—­ì¶”ì„¸ ì§„ì… ê°€ëŠ¥
}
```

#### ğŸ“ˆ LONG ì§„ì… ì¡°ê±´

```dart
if (
  currentPrice <= bb.lower &&      // BB í•˜ë‹¨ ì´í•˜
  rsi < 35 &&                       // RSI ê³¼ë§¤ë„
  macd.histogram > prevMacdHistogram && // MACD ê°œì„  ì¤‘
  volume.relativeVolumeRatio < 10.0     // Volume í­ë°œ ì•„ë‹˜
) {
  return LongSignal(
    entry: currentPrice,
    stopLoss: currentPrice * (1 - 0.003),  // -0.3%
    takeProfit1: bb.middle,                // 1ì°¨ ìµì ˆ: BB Middle
    takeProfit2: bb.upper,                 // 2ì°¨ ìµì ˆ: BB Upper
    positionSize: calculatePositionSize(confidence),
    confidence: confidence,
    strategy: 'COUNTER_TREND',
  );
}
```

#### ğŸ“‰ SHORT ì§„ì… ì¡°ê±´

```dart
if (
  currentPrice >= bb.upper &&      // BB ìƒë‹¨ ì´ìƒ
  rsi > 65 &&                       // RSI ê³¼ë§¤ìˆ˜
  macd.histogram < prevMacdHistogram && // MACD ì•…í™” ì¤‘
  volume.relativeVolumeRatio < 10.0     // Volume í­ë°œ ì•„ë‹˜
) {
  return ShortSignal(
    entry: currentPrice,
    stopLoss: currentPrice * (1 + 0.003),  // +0.3%
    takeProfit1: bb.middle,                // 1ì°¨ ìµì ˆ: BB Middle
    takeProfit2: bb.lower,                 // 2ì°¨ ìµì ˆ: BB Lower
    positionSize: calculatePositionSize(confidence),
    confidence: confidence,
    strategy: 'COUNTER_TREND',
  );
}
```

### ğŸš€ ì „ëµ 2: ì¶”ì„¸ ì¶”ì¢… (Trend-Following) - ë°´ë“œì›Œí‚¹

**ì ìš© ì¡°ê±´**:
```dart
// ë°´ë“œì›Œí‚¹ HIGH í™•ì • ì‹œì—ë§Œ ì§„ì…
if (
  bandWalkingSignal.risk == BandWalkingRisk.HIGH &&
  bandWalkingSignal.consecutiveOutside >= 3 &&
  (marketCondition == extremeBullish ||
   marketCondition == extremeBearish)
) {
  // ì¶”ì„¸ ì¶”ì¢… ì§„ì… ê°€ëŠ¥
}
```

#### ğŸ“ˆ LONG ì§„ì… (ìƒìŠ¹ ë°´ë“œì›Œí‚¹)

```dart
if (
  bandWalkingSignal.direction == 'UP' &&
  rsi > 65 &&                           // RSI ê³¼ë§¤ìˆ˜ ìœ ì§€
  macd.histogram > 5.0 &&               // ê°•í•œ ìƒìŠ¹ ëª¨ë©˜í…€
  volume.relativeVolumeRatio > 3.0      // ë†’ì€ ê±°ë˜ëŸ‰ ì§€ì†
) {
  return LongSignal(
    entry: currentPrice,
    stopLoss: bb.middle,                 // SL: BB Middle
    takeProfit: null,                    // Trailing Stop ì‚¬ìš©
    trailingStopPercent: 0.02,          // 2% Trailing
    positionSize: calculatePositionSize(SignalConfidence.HIGH) * 1.5,  // 150%
    confidence: SignalConfidence.HIGH,
    strategy: 'TREND_FOLLOWING_BANDWALKING',
  );
}
```

#### ğŸ“‰ SHORT ì§„ì… (í•˜ë½ ë°´ë“œì›Œí‚¹)

```dart
if (
  bandWalkingSignal.direction == 'DOWN' &&
  rsi < 35 &&                           // RSI ê³¼ë§¤ë„ ìœ ì§€
  macd.histogram < -5.0 &&              // ê°•í•œ í•˜ë½ ëª¨ë©˜í…€
  volume.relativeVolumeRatio > 3.0 &&   // ë†’ì€ ê±°ë˜ëŸ‰ ì§€ì†
  priceChangePercent > -1.5             // ì•„ì§ 1.5% ì´ìƒ ì•ˆ ë–¨ì–´ì§ (ëŠ¦ì§€ ì•ŠìŒ)
) {
  // íŒ¨ë‹‰ ì…€ë§ ì²´í¬
  if (rsi < 25 && volume.relativeVolumeRatio > 20) {
    Logger.warning('íŒ¨ë‹‰ ì…€ë§ ê°ì§€ - SHORT ì§„ì… ë³´ë¥˜ (ì¶”ê°€ í•˜ë½ í›„ ë°˜ë“± ëŒ€ê¸°)');
    return null;
  }

  return ShortSignal(
    entry: currentPrice,
    stopLoss: bb.middle,                 // SL: BB Middle
    takeProfit: null,                    // Trailing Stop ì‚¬ìš©
    trailingStopPercent: 0.02,          // 2% Trailing
    positionSize: calculatePositionSize(SignalConfidence.HIGH) * 1.2,  // 120%
    confidence: SignalConfidence.HIGH,
    strategy: 'TREND_FOLLOWING_BANDWALKING',
  );
}
```

### â¸ï¸ ì „ëµ 3: ê´€ë§ (WAIT)

**ê´€ë§ ì¡°ê±´**:
```dart
// ë‹¤ìŒ ì¤‘ í•˜ë‚˜ë¼ë„ í•´ë‹¹í•˜ë©´ ê´€ë§
if (
  // 1. ë¸Œë ˆì´í¬ì•„ì›ƒ ì´ˆê¸° (1-2ìº”ë“¤) - ë°´ë“œì›Œí‚¹ ì „í™˜ ê°€ëŠ¥ì„±
  (breakoutType == BreakoutType.BREAKOUT_INITIAL) ||

  // 2. ë°´ë“œì›Œí‚¹ ì „í™˜ ì¤‘ (ë¶ˆí™•ì‹¤)
  (breakoutType == BreakoutType.BREAKOUT_TO_BANDWALKING &&
   bandWalkingSignal.risk == BandWalkingRisk.MEDIUM) ||

  // 3. ë‚®ì€ ì‹ ë¢°ë„
  (confidence == SignalConfidence.LOW) ||

  // 4. ì§€í‘œ ê°„ ë¶ˆì¼ì¹˜ (agreeCount < 3)
  (agreeCount < 3)
) {
  Logger.info('ê´€ë§: ${reason}');
  return null;
}
```

---

## ë¦¬ìŠ¤í¬ ê´€ë¦¬

### ğŸ’° í¬ì§€ì…˜ ì‚¬ì´ì§•

```dart
double calculatePositionSize(SignalConfidence confidence) {
  final baseSize = totalCapital * 0.05;  // ê¸°ë³¸ 5%

  switch (confidence) {
    case SignalConfidence.HIGH:
      return baseSize * 1.0;  // 100% (ìë³¸ì˜ 5%)
    case SignalConfidence.MEDIUM:
      return baseSize * 0.6;  // 60% (ìë³¸ì˜ 3%)
    case SignalConfidence.LOW:
      return baseSize * 0.0;  // 0% (ì§„ì… ê¸ˆì§€)
  }
}

// ë°´ë“œì›Œí‚¹ í™•ì • ì‹œ í¬ì§€ì…˜ ì¦ê°€
if (bandWalkingSignal.risk == BandWalkingRisk.HIGH) {
  positionSize *= 1.5;  // 150% (ìµœëŒ€ ìë³¸ì˜ 7.5%)
}
```

### ğŸ›¡ï¸ ì†ì ˆ/ìµì ˆ ê·œì¹™

#### ì—­ì¶”ì„¸ ì „ëµ

```dart
// íƒ€ì´íŠ¸í•œ ì†ì ˆ
stopLoss = entry * (1 Â± 0.003);  // Â±0.3%

// ìµì ˆ
takeProfit1 = bb.middle;  // 50% ì²­ì‚°
takeProfit2 = bb.upper/lower;  // ë‚˜ë¨¸ì§€ 50% ì²­ì‚°
```

#### ì¶”ì„¸ ì¶”ì¢… ì „ëµ

```dart
// ë„“ì€ ì†ì ˆ (BB Middle)
stopLoss = bb.middle;

// Trailing Stop
trailingStop = 2.0%;  // ìµœê³ ê°€/ìµœì €ê°€ ëŒ€ë¹„ 2%
```

### âš ï¸ ê¸´ê¸‰ ì†ì ˆ ì¡°ê±´

```dart
// ë¬´ì¡°ê±´ ì†ì ˆ
if (
  // 1. ë°˜ëŒ€ ë°©í–¥ ë°´ë“œì›Œí‚¹ ë°œìƒ
  (position == LONG && bandWalkingSignal.direction == 'DOWN' &&
   bandWalkingSignal.risk == BandWalkingRisk.HIGH) ||

  // 2. ê·¹ë‹¨ì  ì—­ì¶”ì„¸
  (position == LONG && marketCondition == extremeBearish) ||
  (position == SHORT && marketCondition == extremeBullish) ||

  // 3. ì¼ì¼ ì†ì‹¤ í•œë„ ë„ë‹¬
  (dailyLoss >= totalCapital * 0.02)  // -2%
) {
  emergencyClose();
}
```

---

## êµ¬í˜„ ê³„íš

### Phase 1: í•µì‹¬ ë¡œì§ êµ¬í˜„ (1ì£¼)

#### íŒŒì¼ êµ¬ì¡°

```
lib/services/v3/
â”œâ”€â”€ composite_analyzer.dart          # ë³µí•© ì§€í‘œ ë¶„ì„
â”œâ”€â”€ band_walking_detector.dart       # ë°´ë“œì›Œí‚¹ ê°ì§€
â”œâ”€â”€ breakout_classifier.dart         # ë¸Œë ˆì´í¬ì•„ì›ƒ ë¶„ë¥˜
â”œâ”€â”€ entry_strategy_v3.dart           # ì§„ì… ì „ëµ í†µí•©
â””â”€â”€ risk_manager.dart                # ë¦¬ìŠ¤í¬ ê´€ë¦¬

lib/models/v3/
â”œâ”€â”€ market_analysis_result.dart      # ë¶„ì„ ê²°ê³¼
â”œâ”€â”€ band_walking_signal.dart         # ë°´ë“œì›Œí‚¹ ì‹ í˜¸
â”œâ”€â”€ entry_signal.dart                # ì§„ì… ì‹ í˜¸
â””â”€â”€ position.dart                    # í¬ì§€ì…˜ ì •ë³´
```

#### êµ¬í˜„ ìˆœì„œ

1. **CompositeAnalyzer** (ì´ë¯¸ êµ¬í˜„ë¨)
   - `lib/utils/technical_indicators.dart` í™œìš©
   - `analyzeMarketComposite()` í•¨ìˆ˜

2. **BandWalkingDetector** (ì‹ ê·œ)
   - `lib/backtesting/band_walking_analyzer.dart` ì°¸ê³ 
   - ì‹¤ì‹œê°„ ê°ì§€ ë¡œì§ ì¶”ê°€

3. **BreakoutClassifier** (ì‹ ê·œ)
   - ë¸Œë ˆì´í¬ì•„ì›ƒ íŒ¨í„´ êµ¬ë¶„ ë¡œì§

4. **EntryStrategyV3** (ì‹ ê·œ)
   - 4ë‹¨ê³„ í•„í„°ë§ í†µí•©
   - ì—­ì¶”ì„¸ vs ì¶”ì„¸ ì¶”ì¢… ì„ íƒ

5. **RiskManager** (ì‹ ê·œ)
   - í¬ì§€ì…˜ ì‚¬ì´ì§•
   - ì†ì ˆ/ìµì ˆ ê´€ë¦¬

### Phase 2: ë°±í…ŒìŠ¤íŠ¸ ê²€ì¦ (3ì¼)

```dart
// ë°±í…ŒìŠ¤íŠ¸ ë¹„êµ
void main() async {
  // ê¸°ì¡´ ì „ëµ (v2)
  final resultV2 = await runBacktest(
    strategy: SplitEntryStrategy(),
    period: '2025-10-14 ~ 2025-10-21',
  );

  // ìƒˆ ì „ëµ (v3)
  final resultV3 = await runBacktest(
    strategy: EntryStrategyV3(),
    period: '2025-10-14 ~ 2025-10-21',
  );

  // ë¹„êµ
  print('V2 ìŠ¹ë¥ : ${resultV2.winRate}%');
  print('V3 ìŠ¹ë¥ : ${resultV3.winRate}%');
  print('ê°œì„ ë„: ${resultV3.winRate - resultV2.winRate}%');
}
```

### Phase 3: íŒŒë¼ë¯¸í„° ìµœì í™” (3ì¼)

```yaml
ìµœì í™” ëŒ€ìƒ:
  - ë°´ë“œì›Œí‚¹ Score ì„ê³„ê°’ (í˜„ì¬: 50/70)
  - ë³µí•© ì§€í‘œ ê°€ì¤‘ì¹˜ (í˜„ì¬: RSI 25%, Volume 20%, ...)
  - ì†ì ˆ/ìµì ˆ ë¹„ìœ¨
  - í¬ì§€ì…˜ ì‚¬ì´ì§• ë°°ìˆ˜
```

### Phase 4: ë¼ì´ë¸Œ í…ŒìŠ¤íŠ¸ (1ì£¼)

1. Paper Trading (ê°€ìƒ ê±°ë˜)
2. ì†Œì•¡ ì‹¤ê±°ë˜ ($100)
3. ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ë° ì¡°ì •

---

## ğŸ“Š ì˜ˆìƒ ì„±ëŠ¥

### ë°±í…ŒìŠ¤íŠ¸ ëª©í‘œ

| ì§€í‘œ | V2 (í˜„ì¬) | V3 (ëª©í‘œ) | ê°œì„  |
|------|----------|----------|------|
| **ìŠ¹ë¥ ** | 62.5% | 70%+ | +7.5% |
| **Profit Factor** | 0.25 | 0.8+ | +0.55 |
| **ìµœëŒ€ ì†ì‹¤í­** | -3.11% | -2.0% | +1.11% |
| **í‰ê·  ì†ì‹¤** | -$101.80 | -$50 | +$51.80 |
| **ê±°ì§“ ì‹ í˜¸ í•„í„°ë§** | 0ê±´ | 5-8ê±´ | +28% |

### ì‹œë‚˜ë¦¬ì˜¤ë³„ ê°œì„  íš¨ê³¼

#### ì‹œë‚˜ë¦¬ì˜¤ 1: ë°´ë“œì›Œí‚¹ ê°ì§€
```
V2: -2.65% (ìƒìŠ¹ ë°´ë“œì›Œí‚¹ ì¤‘ ì—­ì¶”ì„¸ SHORT)
V3: +2.31% (ì§„ì… ì°¨ë‹¨ + ì¶”ì„¸ ì¶”ì¢… LONG)
ê°œì„ : +4.96%
```

#### ì‹œë‚˜ë¦¬ì˜¤ 2: ë³µí•© ì§€í‘œ ë¶„ì„
```
V2: -2.42% (RSIë§Œ ë³´ê³  ê³¼ë§¤ë„ LONG)
V3: ì§„ì… ì°¨ë‹¨ (MACD ì•…í™”, ë‚®ì€ ì‹ ë¢°ë„)
ê°œì„ : +2.42%
```

---

## ğŸ“š ì°¸ê³  ìë£Œ

### ê´€ë ¨ ë¬¸ì„œ
- `lib/docs/ë°´ë“œì›Œí‚¹_ì‚¬ì „_ê°ì§€_ë¶„ì„.md`: ë°´ë“œì›Œí‚¹ ë¶„ì„
- `lib/docs/composite_market_analysis_system.md`: ë³µí•© ì§€í‘œ ì‹œìŠ¤í…œ
- `lib/docs/ì„ ë¬¼_ìŠ¤ì¼ˆí•‘_ë´‡_ì‹œì¥_ì¶”ì„¸_ë¶„ì„.md`: ê¸°ì¡´ ë¶„ì„

### ë¶„ì„ ë°ì´í„°
- `band_walking_analysis_2025-10-22T00-44-50.csv`: ìƒìŠ¹ ë°´ë“œì›Œí‚¹
- `band_walking_analysis_2025-10-22T00-52-36.csv`: í•˜ë½ ë°´ë“œì›Œí‚¹

---

## ë³€ê²½ ì´ë ¥

| ë‚ ì§œ | ë²„ì „ | ë³€ê²½ ë‚´ìš© |
|------|------|-----------|
| 2025-10-22 | 3.0.0 | V3 ì§„ì… ì „ëµ ì„¤ê³„ ì™„ë£Œ |

---

**ì‘ì„±ì**: Claude Code
**ìƒíƒœ**: âœ… ì„¤ê³„ ì™„ë£Œ, êµ¬í˜„ ëŒ€ê¸°
**ë‹¤ìŒ ë‹¨ê³„**: Phase 1 êµ¬í˜„ ì‹œì‘
